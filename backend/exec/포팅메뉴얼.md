# ğŸ›  í¬íŒ… ë©”ë‰´ì–¼

## ê°œë°œí™˜ê²½

### í´ë¼ì´ì–¸íŠ¸

- React 17.0.2
- React-Native 0.68.2
- React-Redux 8.0.2
- Typescript 4.4.4
- Axios 0.24.0
- Node.js 16.16.0
- Android SDK Platform 29

### ë°±ì—”ë“œ

- Java 1.8
- Spring Boot 2.7.3
- Spring Data JPA 2.7.3
- Spring Security 5.7.3
- Spring REST Docs 2.0.6
- MySQL 8.0.3
- Redis 5.0.7

### ì¸í”„ë¼
- AWS EC2
- Docker 20.10.18
- NGINX 1.18.0

## í´ë¼ì´ì–¸íŠ¸

### í´ë¼ì´ì–¸íŠ¸ í”„ë¡œì íŠ¸ ë¹Œë“œ

0. node_modules ì„¤ì¹˜

    ```bash
    $ npm install --force
    ```

   í˜„ì¬ nmapê³¼ react-native ê°„ì˜ ë²„ì „ ì¶©ëŒë¡œ ê°•ì œ ì„¤ì¹˜ í•„ìš”
   
1. ì•ˆë“œë¡œì´ë“œ ìŠ¤íŠœë””ì˜¤ì—ì„œ ì—ë®¬ë ˆì´í„° ìƒì„±
    - `/frontend/mountaindo/android` ìœ„ì¹˜ì—ì„œ ì•ˆë“œë¡œì´ë“œ ìŠ¤íŠœë””ì˜¤ ì—´ì–´ì„œ ë¹Œë“œ
    - ë¹Œë“œ í›„ ìš°ì¸¡ íƒ­ì— Device Managerë¥¼ ì—´ì–´ Create device ë²„íŠ¼ í´ë¦­
    - ë””ë°”ì´ìŠ¤ ì„ íƒ(Nexus 5 - ê°œë°œì— ì‚¬ìš©í•œ ë””ë°”ì´ìŠ¤) í›„ API Level 29ë¡œ ì—ë®¬ë ˆì´í„° ìƒì„±
2. í”„ë¡œì íŠ¸ì— ì¶”ê°€ íŒŒì¼ ìƒì„±
    - `/mountaindo/android/app` ì— `debug.keystore` ì¶”ê°€ (ë””ë²„ê·¸ í‚¤ ì €ì¥ì†Œ ê³µì‹ í…œí”Œë¦¿ì—ì„œ ë‹¤ìš´ë¡œë“œ)
    - `/mountaindo/` ì— `.env` íŒŒì¼ ì¶”ê°€

        ```
        NAVER_MAP_KEY=
        WEATHER_API_KEY=
        KAKAO_NATIVE_APP_KEY=
        KAKAO_NATIVE_APP_KEY_WITH_KAKAO=kakao
        REACT_APP_BE_HOST=
        CURRENT_WEATHER_API_KEY=
        ```

      í”„ë¡œì íŠ¸ êµ¬ë™ì„ ìœ„í•œ API Key ìƒì„± í›„ .env íŒŒì¼ì— ì¶”ê°€

3. ì•ˆë“œë¡œì´ë“œ ì• ë®¬ë ˆì´í„° ì‹¤í–‰

    ```bash
    $ npm run android
    ```


### Google Play Console ë°°í¬

1. ì„œëª…í‚¤ ìƒì„±
   
   `android/app`ë¡œ ì´ë™í•´ ì•„ë˜ ëª…ë ¹ì–´ë¡œ ì„œëª…í‚¤ ìƒì„±
   
   ```bash
   $ keytool -genkey -v -keystore my-release-key.keystore -alias my-key-alias -keyalg RSA -keysize 2048 -validity 10000
   ```
   
   - `my-release-key` : ì‹ë³„í•  Key ì´ë¦„
   
   - `my-key-alias` : Appì„ Keystore íŒŒì¼ë¡œ ì„œëª…í•  ë•Œ ì‚¬ìš©í•  ì´ë¦„
   
   ```
   í‚¤ ì €ì¥ì†Œ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ : {ë¹„ë°€ë²ˆí˜¸}
   ìƒˆ ë¹„ë°€ë²ˆí˜¸ ë‹¤ì‹œ ì…ë ¥ : {ìƒˆ ë¹„ë°€ë²ˆí˜¸}
   ì´ë¦„ê³¼ ì„±ì„ ì…ë ¥í•˜ì‹­ì‹œì˜¤. : {ì´ë¦„}
   ì¡°ì§ ë‹¨ìœ„ ì´ë¦„ì„ ì…ë ¥í•˜ì‹­ì‹œì˜¤. : {ì¡°ì§ ë‹¨ìœ„ ì´ë¦„}
   ì¡°ì§ ì´ë¦„ì„ ì…ë ¥í•˜ì‹­ì‹œì˜¤. : {ì¡°ì§ ì´ë¦„}
   êµ¬/êµ°/ì‹œ ì´ë¦„ì„ ì…ë ¥í•˜ì‹­ì‹œì˜¤? : {êµ¬ ì´ë¦„}
   ì‹œ/ë„ ì´ë¦„ì„ ì…ë ¥í•˜ì‹­ì‹œì˜¤. : {ì‹œ ì´ë¦„}
   ì´ ì¡°ì§ì˜ ë‘ ìë¦¬ êµ­ê°€ ì½”ë“œë¥¼ ì…ë ¥í•˜ì‹­ì‹œì˜¤ : {êµ­ê°€ ì½”ë“œ}
   CN={ì´ë¦„}, OU={ì¡°ì§ ë‹¨ìœ„ ì´ë¦„}, O={ì¡°ì§ ì´ë¦„}, L={êµ¬ ì´ë¦„}, ST={ì‹œ ì´ë¦„}, C={êµ­ê°€ ì½”ë“œ} ì´(ê°€) ë§ìŠµë‹ˆê¹Œ? y
   
   ë‹¤ìŒì— ëŒ€í•´ ìœ íš¨ê¸°ê°„ì´ 36,500ì¼ì¸ 2,048ë¹„íŠ¸ RSA í‚¤ ìŒ ë° ìì²´ ì„œëª…ëœ ì¸ì¦ì„œ (SHA256withRSA)ë¥¼ ìƒì„±í•˜ëŠ”ì¤‘
    : CN={ì´ë¦„}, OU={ì¡°ì§ ë‹¨ìœ„ ì´ë¦„}, O={ì¡°ì§ ì´ë¦„}, L={êµ¬ ì´ë¦„}, ST={ì‹œ ì´ë¦„}, C={êµ­ê°€ ì½”ë“œ}
   
   <relesase_key>ì— ëŒ€í•œ í‚¤ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì‹­ì‹œì˜¤.
   (í‚¤ ì €ì¥ì†Œ ë¹„ë°€ë²ˆí˜¸ì™€ ë™ì¼í•œ ê²½ìš° Enter í‚¤ë¥¼ ëˆ„ë¦„) : {í‚¤ ë¹„ë°€ë²ˆí˜¸}
   ```

2. android.gradlew.properties ìˆ˜ì •
   
   ì•„ë˜ ë‚´ìš© ì¶”ê°€
   
   ```
   MYAPP_RELEASE_STORE_FILE=xxxxxx.keystore 
   MYAPP_RELEASE_KEY_ALIAS=xxxxxx 
   MYAPP_RELEASE_KEY_PASSWORD=xxxxxx 
   MYAPP_RELEASE_STORE_PASSWORD=xxxxxx
   ```

3. android/build.gradle ì„¤ì • ì¶”ê°€
   
   ```
      signingConfigs {
         debug {
            ...
         }
         release {
            if (project.hasProperty('MYAPP_RELEASE_STORE_FILE')) {
               storeFile file(MYAPP_RELEASE_STORE_FILE)
               storePassword MYAPP_RELEASE_STORE_PASSWORD
               keyAlias MYAPP_RELEASE_KEY_ALIAS
               keyPassword MYAPP_RELEASE_KEY_PASSWORD
            }
         }
      }
      buildTypes {
         ...
         release {
            // Caution! In production, you need to generate your own keystore file.
            // see https://reactnative.dev/docs/signed-apk-android.
            signingConfig signingConfigs.debug
            signingConfig signingConfigs.release
            minifyEnabled enableProguardInReleaseBuilds
            proguardFiles getDefaultProguardFile("proguard-android.txt"), "proguard-rules.pro"
         }
      }
   ```

4. release.apk & .aab ìƒì„±
   
   ```bash
   $ cd android && ./gradlew assembleRelease
   $ cd android && ./gradlew bundleRelease
   ```
   
   - APK :  android/app/build/outputs/apk/app-release.apk
   - AAB : android/app/build/outputs/bundle/app-release.aab

5. Firebase Test Lab
   
   - Firebase í”„ë¡œì íŠ¸ ìƒì„±
   - TestLab AABíŒŒì¼ ì‚½ì… â†’ ì„±ê³µ ì‹œ GooglePlayConsole ë“±ë¡

## ë°±ì—”ë“œ

### ê°œë°œ í™˜ê²½ ì„¸íŒ…

```bash
# aptë¥¼ ìµœì‹  ìƒíƒœë¡œ ì—…ë°ì´íŠ¸
$ sudo apt update
```

#### 1. JDK ì„¤ì¹˜

```bash
# openjdk-8 ì„¤ì¹˜
$ sudo apt install openjdk-8-jdk

# java ë²„ì „ í™•ì¸
$ java -version

# java ë²„ì „ ë³€ê²½
$ sudo update-alternatives --config java
```

#### 2. Java í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

```bash
$ sudo vim /etc/profile
```

ì•„ë˜ ë‚´ìš©ì„ /etc/profileì˜ ê°€ì¥ ì•„ë˜ ì¶”ê°€

```
export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64
export PATH=$JAVA_HOME/bin:$PATH
export CLASSPATH=$CLASSPATH:$JAVA_HOME/jre/lib/ext:$JAVA_HOME/lib/tools.jar
```

ì•„ë˜ ëª…ë ¹ì–´ë¡œ í™˜ê²½ë³€ìˆ˜ê°€ ì œëŒ€ë¡œ ì„¸íŒ…ëëŠ”ì§€ í™•ì¸

```bash
$ echo $JAVA_HOME
```

#### 3. NGINX

1. ì„¤ì¹˜

   ```bash
   $ sudo apt update
   $ sudo apt install nginx
   ```

2. ì‹¤í–‰

   ```bash
   $ sudo service nginx start
   ```

   í˜¹ì€
   
   ```bash
   $ sudo systemctl start nginx # nginx ì‹¤í–‰
   $ sudo systemctl status nginx # nginx ìƒíƒœ í™•ì¸
   ```

3. êµ¬ë™ í…ŒìŠ¤íŠ¸
   
   ```bash
   $ sudo netstat -lntp
   
   # netstat ëª…ë ¹ì–´ê°€ ì—†ìœ¼ë©´ net-tools ì„¤ì¹˜
   $ sudo apt install net-tools
   ```
   
   80ë²ˆ í¬íŠ¸ê°€ ë¦¬ìŠ¤ë‹ë˜ê³  ìˆìœ¼ë©´ ì‹¤í–‰ ìƒíƒœ
   
   ![Untitled](https://user-images.githubusercontent.com/62989828/194398865-2c3d7756-18ec-40dc-a8f4-6173d6e5aa1c.png)

### HTTPS ì ìš© (SSL)

1. ë°©í™”ë²½ ì„¤ì •

    ```bash
    $ sudo apt update
    $ sudo apt install ufw
    $ sudo ufw allow ssh
    $ sudo ufw allow http
    $ sudo ufw allow https
    $ sudo ufw enable
    $ sudo ufw status
    ```

   ![Untitled](https://user-images.githubusercontent.com/62989828/194400040-98d18426-45f0-4978-a0a0-25492f371265.png)

2. Snap ì„¤ì¹˜

    ```bash
    # snapd ì„¤ì¹˜
    $ sudo apt update
    $ sudo apt install snapd
    
    # core snap ì„¤ì¹˜
    $ sudo snap install core
    $ sudo snap refresh core
    ```

3. Certbot ì„¤ì¹˜

    ```bash
    $ sudo apt remove certbot
    $ sudo snap install --classic certbot
    $ sudo ln -s /snap/bin/certbot /usr/bin/certbot
    ```

4. SSL ì¸ì¦ì„œ ìš”ì²­

    ```bash
    $ sudo certbot --nginx
    $ sudo certbot certonly --nginx
    ```

    - ì´ë©”ì¼ ì…ë ¥ í›„ ì—”í„°

      ![Untitled](https://user-images.githubusercontent.com/62989828/194400147-ef47a224-748e-4831-8cb5-7a26078422e6.png)

     - ë™ì˜(y) ì…ë ¥ í›„ ì—”í„°
   
      ![Untitled](https://user-images.githubusercontent.com/62989828/194400257-a2e6e7c2-5005-4ef1-a7d2-ef1a61be10b1.png)

    - ì´ë©”ì¼ ìˆ˜ì‹  - ë¹„ë™ì˜(n) ì…ë ¥ í›„ ì—”í„°

      ![Untitled](https://user-images.githubusercontent.com/62989828/194400338-2a5281a7-0069-40fe-b5f6-c85f22e36fc4.png)

    - httpsë¥¼ ì ìš©í•  ë„ë©”ì¸ ì„ íƒ í›„ ì—”í„°

      ![Untitled](https://user-images.githubusercontent.com/62989828/194400402-732170f8-ca09-45e7-813f-bc1810d656d8.png)


### Docker ì„¤ì¹˜

```bash
$ sudo apt install docker.io
```

í”„ë¡œì íŠ¸ ìµœìƒë‹¨ì— Dockerfile ìƒì„±

- Spring-boot ì„œë²„ Dockerfile

  | /S07P22B201/backend/spring-boot/Dockerfile

    ```
    FROM openjdk:8
    
    EXPOSE 8080
    
    ARG JAR_FILE=build/libs/spring-boot-0.0.1-SNAPSHOT.jar
    
    COPY ${JAR_FILE} app.jar
    
    ENTRYPOINT ["java", "-jar", "/app.jar"]
    
    ENV TZ=Asia/Seoul
    RUN apt-get install -y tzdata
    ```

- Flask ì„œë²„ Dockerfile

  | /S07P22B201/backend/flask/Dockerfile

    ```
    FROM python:3.9-slim
    
    COPY . /app
    
    RUN pip3 install flask
    
    RUN pip3 install pandas
    
    RUN pip3 install apscheduler
    
    RUN pip3 install pymysql
    
    RUN pip3 install sklearn
    
    RUN pip3 install cryptography
    
    WORKDIR /app
    
    CMD ["python3", "-m", "flask", "run", "--host=0.0.0.0"]
    ```


### Redis ì„¤ì¹˜

```bash
$ sudo apt install redis-server
```

1. Redis ì„¤ì • íŒŒì¼ ìˆ˜ì •
   
   Redis ì„¤ì • íŒŒì¼ì— ì•„ë˜ ë‚´ìš© ì¶”ê°€
   
   | /etc/redis/redis.conf
   
   ```
   bind 0:0:0:0 ::1
   ...
   maxmemory 1g
   ...
   maxmemory-policy allkeys-lru
   ```

2. Redis ì‹¤í–‰
   
   ```bash
   $ sudo service start redis-server
   ```

### í”„ë¡œì íŠ¸ ë¹Œë“œ

1. í”„ë¡œì íŠ¸ ë‹¤ìš´ë¡œë“œ

   ```bash
   $ git clone https://lab.ssafy.com/s07-bigdata-recom-sub2/S07P22B201.git
   ```

2. Spring-boot ì„œë²„ ì‹¤í–‰
   
   ```bash
   $ cd S07P22B201/backend/spring-boot # spring-boot í”„ë¡œì íŠ¸ë¡œ ì´ë™
   $ sh deploy.sh # docker ì»¨í…Œì´ë„ˆ ì‹¤í–‰
   ```
   
   | deploy.sh
   
   ```bash
   #!/bin/bash
   
   ./gradlew build
   
   sudo docker stop mountaindo_deploy
   
   sudo docker rm mountaindo_deploy
   
   sudo docker rmi mountaindo_deploy
   
   sudo docker build -t mountaindo_deploy .
   
   sudo docker run -d -p 8080:8080 --name mountaindo_deploy mountaindo_deploy
   
   sudo docker -v ./img:/home mountaindo_deploy
   
   sudo docker logs -f mountaindo_deploy
   ```

3. Flask ì„œë²„ ì‹¤í–‰
   
   | deploy.sh
   
   ```bash
   #!/bin/bash
   
   sudo docker stop mountaindo_deploy_flask
   
   sudo docker rm mountaindo_deploy_flask
   
   sudo docker rmi mountaindo_deploy_flask
   
   sudo docker build -t mountaindo_deploy_flask .
   
   sudo docker run -d -p 5000:5000/tcp --name mountaindo_deploy_flask mountaindo_deploy_flask 
   
   sudo docker logs -f mountaindo_deploy_flask
   ```
